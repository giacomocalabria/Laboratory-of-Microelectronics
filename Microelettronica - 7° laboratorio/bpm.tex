A partire dallâ€™array acquisito, scrivere un codice che permetta di misurare la frequenza cardiaca e visualizzarne il corrispondente valore sul display
\begin{lstlisting}[frame=single, language=Arduino]
int findBPM(int array[]){
    int min = findmin(array);
    int threshold = (findmax(array) - min) / 1.5 + min;
    int peaks = 0;
    int timeOfPeaks[arraySize/2];
    for(int i = 0; i < arraySize; i++){
        if(array[i] > threshold){
            timeOfPeaks[peaks] = i;
            peaks++;
            i+=2;
            while(array[i] > threshold){
                i++;
            }
        }
    }
    FistPeaks = timeOfPeaks[0] * 20;
    LastPeaks = timeOfPeaks[peaks-1] * 20;

    TimeInterval = LastPeaks - FirstPeaks; // in microseconds
    
    return peaks / ((TimeInterval) / 60000);
}
\end{lstlisting}